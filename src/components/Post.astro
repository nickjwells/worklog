---
interface Props {
  content: string;
  timestamp: string;
  category?: 'update' | 'thought';
  curated?: boolean;
}

const { content, timestamp, category = 'update', curated = false } = Astro.props;

// Convert URLs to clickable links
function linkify(text: string): string {
  const urlPattern = /(https?:\/\/[^\s<]+)/g;
  return text.replace(urlPattern, (url) => {
    let cleanUrl = url;
    const trailingPunct = /[).,!?;:'"]+$/;
    const match = cleanUrl.match(trailingPunct);
    const trailing = match ? match[0] : '';
    cleanUrl = cleanUrl.replace(trailingPunct, '');
    return `<a href="${cleanUrl}" target="_blank" rel="noopener noreferrer" class="post-link">${cleanUrl}</a>${trailing}`;
  });
}

const linkedContent = linkify(content);

const date = new Date(timestamp);
const formatted = date.toLocaleDateString('en-US', {
  month: 'long',
  day: 'numeric',
  year: 'numeric',
});

const categoryLabel = category === 'thought' ? 'Thought' : 'Update';
const isThought = category === 'thought';
---

<article
  class="py-8 post-article"
  data-category={category}
  data-curated={curated.toString()}
>
  <div class="flex items-center gap-2 mb-2">
    <p class={`text-xs font-medium tracking-wide uppercase ${isThought ? 'category-thought' : 'category-update'}`}>
      {categoryLabel}
    </p>
    {curated && (
      <span class="text-xs px-2 py-0.5 rounded-full curated-badge">
        Curated
      </span>
    )}
  </div>
  <h2 class="text-2xl font-semibold leading-tight tracking-tight whitespace-pre-line post-content" set:html={linkedContent}>
  </h2>
  <time
    datetime={timestamp}
    class="text-sm mt-3 block post-time"
  >
    {formatted}
  </time>
</article>

<style>
  .post-article {
    border-bottom: 1px solid var(--color-border);
  }
  .post-content {
    color: var(--color-text-primary);
  }
  .post-time {
    color: var(--color-text-secondary);
  }
  .category-thought {
    color: var(--color-accent);
  }
  .category-update {
    color: var(--color-text-secondary);
  }
  .curated-badge {
    background-color: var(--color-bg-secondary);
    color: var(--color-text-primary);
  }
  .post-link {
    color: var(--color-accent);
  }
  .post-link:hover {
    text-decoration: underline;
  }
</style>
