---
interface Props {
  content: string;
  timestamp: string;
  category?: 'update' | 'thought';
  curated?: boolean;
}

const { content, timestamp, category = 'update', curated = false } = Astro.props;

// Convert URLs to clickable links
function linkify(text: string): string {
  const urlPattern = /(https?:\/\/[^\s<]+)/g;
  return text.replace(urlPattern, (url) => {
    // Strip trailing punctuation that's likely not part of the URL
    let cleanUrl = url;
    const trailingPunct = /[).,!?;:'"]+$/;
    const match = cleanUrl.match(trailingPunct);
    const trailing = match ? match[0] : '';
    cleanUrl = cleanUrl.replace(trailingPunct, '');
    return `<a href="${cleanUrl}" target="_blank" rel="noopener noreferrer" class="text-[#0071e3] hover:underline">${cleanUrl}</a>${trailing}`;
  });
}

const linkedContent = linkify(content);

const date = new Date(timestamp);
const formatted = date.toLocaleDateString('en-US', {
  month: 'long',
  day: 'numeric',
  year: 'numeric',
});

const categoryLabel = category === 'thought' ? 'Thought' : 'Update';
const categoryColor = category === 'thought' ? 'text-[#0071e3]' : 'text-[#86868b]';
---

<article
  class="py-8 border-b border-[#d2d2d7]"
  data-category={category}
  data-curated={curated.toString()}
>
  <div class="flex items-center gap-2 mb-2">
    <p class={`text-xs font-medium tracking-wide uppercase ${categoryColor}`}>
      {categoryLabel}
    </p>
    {curated && (
      <span class="text-xs px-2 py-0.5 bg-[#f5f5f7] text-[#1d1d1f] rounded-full">
        Curated
      </span>
    )}
  </div>
  <h2 class="text-2xl font-semibold text-[#1d1d1f] leading-tight tracking-tight whitespace-pre-line" set:html={linkedContent}>
  </h2>
  <time
    datetime={timestamp}
    class="text-sm text-[#86868b] mt-3 block"
  >
    {formatted}
  </time>
</article>
